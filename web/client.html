<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HSHAMMOG WebSocket Test</title>
    <script language="javascript" type="text/javascript">
        var uri = "ws://222.122.192.57:8080/";
        var output;

        function init() {
            output = document.getElementById("output")
            connect()
        }

        function connect() {
            websocket = new WebSocket(uri);

            websocket.onopen = onOpen;
            websocket.onclose = onClose;
            websocket.onmessage = onMessage;
            websocket.onerror = onError;

            handlers = {
                sAccept: onSAccept,
                rList: onRList,
                rJAccept: onJAccept,
                rBMsg: onRBMsg
            };
        }

        function onOpen(event) {
            writeToScreen("CONNECTED");
            sendMessage({ cmd: 'sConnect' });
        }

        function onClose(event) {
        }

        function onMessage(event) {
            writeToScreen(event.data);

            var message = JSON.parse(event.data);
            handlers[message.cmd](message);
        }

        function onError(event) {
        }

        function onSAccept(message) {
            sendMessage({ cmd: 'rLookup', cId: message.cId, nMaxRoom: 4 })
        }

        function onRList(message) {
            sendMessage({ cmd: 'rJoin', cId: message.cId, rId: 0 });
        }

        function onJAccept(message) {
            var text = 'hello';
            sendMessage({ cmd: 'rMsg', cIdSrc: message.cId, cIdDest: -1, rId: message.rId, msg: text });
        }

        function onRBMsg(message) {
        }

        function sendMessage(message) {
            websocket.send(JSON.stringify(message) + '\n');
        }

        function writeToScreen(message) {
            var pre = document.createElement("p");
            pre.style.wordWrap = "break-word";
            pre.innerHTML = message
            output.appendChild(pre)
        }

        window.addEventListener("load", init, false);
    </script>
</head>
<body>
<h2>HSHAMMOG WebSocket Test</h2>
<div id="output"></div>
</body>
</html>
